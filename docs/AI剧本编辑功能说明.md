# AI剧本编辑功能说明

## 功能概述

在剧本编辑器中新增了两个AI辅助功能，帮助创作者更高效地完善剧本内容。

## 功能列表

### 1. AI续写 ✨

**功能描述**: 基于已有的剧本内容，由AI自动续写后续情节。

**使用场景**:
- 创作灵感枯竭时，让AI帮助推进剧情
- 快速扩展故事大纲
- 探索不同的情节发展方向

**使用方法**:
1. 在剧本编辑器中输入现有的剧本内容
2. 点击右上角的 **"AI续写"** 按钮（蓝色按钮，Plus图标）
3. AI将分析现有内容并自动续写后续情节
4. 续写的内容会自动追加到原有剧本的末尾

**特点**:
- 保持与原有剧本的风格和语气一致
- 续写长度约为原内容的30-50%
- 自然流畅的情节发展
- 增加戏剧冲突和情感张力

### 2. AI改写 🔄

**功能描述**: 对整个剧本进行全面改写，使情节更加连贯流畅。

**使用场景**:
- 剧本初稿完成后需要润色优化
- 情节结构混乱需要重新整理
- 对话不够自然需要改进
- 节奏把握不当需要调整

**使用方法**:
1. 在剧本编辑器中输入需要改写的完整剧本
2. 点击右上角的 **"AI改写"** 按钮（紫色按钮，RotateCw图标）
3. AI将对整个剧本进行分析和重写
4. 改写后的内容会替换原有剧本

**特点**:
- 保留核心故事线和主要人物
- 优化情节结构，因果关系更清晰
- 增强场景转换的流畅性
- 丰富人物对话，使其更生动自然
- 加强戏剧冲突和情感深度
- 优化整体节奏

## 按钮位置

两个按钮位于 **剧本编辑器顶部右侧**，在"MARKDOWN SUPPORTED"标签旁边:

```
┌─────────────────────────────────────────────────────────────┐
│ 剧本编辑器           [AI续写] [AI改写] MARKDOWN SUPPORTED    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  在此输入故事大纲或直接粘贴剧本...                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 按钮状态

- **正常状态**: 蓝色(续写) / 紫色(改写)，可点击
- **处理中**: 显示动画图标，显示"续写中..." / "改写中..."
- **禁用状态**: 灰色，当编辑器为空或其他操作进行中时禁用

## 技术细节

### API调用
- 续写功能使用 `continueScript()` API
- 改写功能使用 `rewriteScript()` API
- 默认使用项目配置的模型（如 GPT-5.1）
- 支持自定义模型选择

### 日志记录
- 所有AI操作都会记录到渲染日志中
- 类型标记为 `script-parsing`
- 包含耗时、使用的模型等信息

### 错误处理
- 网络错误自动重试（最多3次）
- 失败时显示友好的错误提示
- 不会丢失原有内容

## 注意事项

1. **续写功能**: 确保已有内容有足够的上下文，以便AI理解剧情走向
2. **改写功能**: 会完全替换原有内容，建议重要内容先备份
3. **语言一致性**: AI会使用项目配置中设置的语言进行创作
4. **处理时间**: 根据内容长度和服务器负载，处理可能需要几秒到几十秒
5. **API密钥**: 确保已正确配置 API Key

## 最佳实践

### 使用AI续写
1. 提供清晰的剧情开端和人物设定
2. 确保已有内容具有明确的情节走向
3. 可以多次使用续写功能，逐步扩展剧本

### 使用AI改写
1. 先完成剧本的初稿
2. 明确标注主要人物和关键情节点
3. 改写后检查是否保留了核心要素
4. 可以在改写结果基础上继续手动调整

## 工作流程建议

```
1. 手动输入故事大纲和核心设定
   ↓
2. 使用"AI续写"扩展剧情
   ↓
3. 手动调整和补充细节
   ↓
4. 使用"AI改写"优化整体结构
   ↓
5. 最终润色和个性化调整
   ↓
6. 点击"生成分镜脚本"进入下一阶段
```

## 更新记录

- **2025-12-15**: 初版发布，支持AI续写和AI改写功能
