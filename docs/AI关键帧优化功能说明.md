# AI关键帧优化功能说明

## 功能概述

在导演工作台中为起始帧和结束帧添加了AI优化功能，通过场景信息和叙事动作自动生成更精准、更详细的视觉描述。

## 功能位置

**导演工作台 (Stage 2)** → 选择镜头 → 起始帧/结束帧标题栏 → ✨ 图标

## 使用方法

### 1. 进入导演工作台
- 在导演工作台中选择任意镜头
- 查看右侧工作区的"视觉制作"部分

### 2. AI优化关键帧
- 点击起始帧或结束帧标题旁的 **✨ (Sparkles)** 图标
- AI将自动分析以下信息：
  - 场景信息（地点、时间、氛围）
  - 叙事动作描述
  - 镜头运动类型
  - 涉及的角色
  - 项目视觉风格
  
### 3. 查看结果
- AI生成的优化提示词会自动更新到关键帧
- 可以点击 ✏️ (Edit) 图标查看和编辑完整提示词
- 点击"生成"按钮生成新的关键帧图像

## AI优化的提示词内容

AI会生成约100-150字的详细视觉描述，包含：

### 起始帧特点
- 建立清晰的初始场景和人物状态
- 为即将发生的动作预留视觉空间
- 设定光影和色调基调
- 展现角色的起始表情、姿态和位置
- 根据镜头运动设置合适的初始构图
- 营造场景氛围

### 结束帧特点
- 展现动作完成后的最终状态
- 体现镜头运动带来的视角变化
- 展现角色的情绪变化和最终姿态
- 可以有戏剧性的光影和色彩变化
- 达到视觉高潮或情绪释放点
- 为下一个镜头衔接做准备

## 优势

### 🎯 精准定位
基于场景和叙事动作的上下文，生成更符合剧情的视觉描述

### 📝 详细描述
- 构图与景别（画面框架、主体位置、层次关系）
- 光影与色彩（光源方向、色温、阴影密度）
- 角色细节（表情、姿态、服装）
- 环境细节（氛围、景深、叙事元素）
- 运动暗示（动态模糊、视觉引导）
- 电影感细节（质感、透视、宽屏构图）

### 🔄 与其他信息协调
- 自动匹配项目视觉风格
- 考虑镜头运动类型
- 结合场景氛围和时间
- 整合角色信息

## 工作流程建议

### 推荐流程
1. 先使用AI优化起始帧提示词
2. 生成起始帧图像
3. 再使用AI优化结束帧提示词
4. 生成结束帧图像
5. 使用两帧图像生成视频

### 可选流程
1. 先手动编辑叙事动作描述
2. 使用AI优化关键帧提示词
3. 手动微调AI生成的提示词
4. 生成关键帧图像

## 技术实现

### API函数
```typescript
optimizeKeyframePrompt(
  frameType: 'start' | 'end',
  actionSummary: string,
  cameraMovement: string,
  sceneInfo: { location: string; time: string; atmosphere: string },
  characterInfo: string[],
  visualStyle: string,
  model: string = 'gpt-5.1'
): Promise<string>
```

### 调用位置
- **服务层**: `services/geminiService.ts`
- **组件层**: `components/StageDirector/index.tsx`
- **UI组件**: `components/StageDirector/KeyframeEditor.tsx`

## 注意事项

1. **场景信息必需**：需要确保镜头关联到有效的场景
2. **叙事动作建议**：先编辑好叙事动作描述，可以获得更好的优化效果
3. **视觉风格影响**：不同的视觉风格会影响AI生成的描述风格
4. **网络状态**：需要良好的网络连接和有效的API Key
5. **加载状态**：优化过程中按钮会显示加载动画，完成后自动更新

## 与现有功能的对比

| 功能 | AI优化关键帧 | 传统关键帧生成 |
|------|------------|--------------|
| 提示词来源 | AI基于场景和动作生成 | 基于叙事动作+固定模板 |
| 细节程度 | 100-150字详细描述 | 简短描述+技术参数 |
| 上下文理解 | 深度理解场景和角色 | 基础模板组合 |
| 个性化程度 | 针对每个镜头定制 | 标准化流程 |
| 操作步骤 | 点击AI优化 → 生成图像 | 直接生成图像 |

## 更新日志

**版本**: v1.0  
**日期**: 2025-12-20  
**变更**:
- ✨ 新增 `optimizeKeyframePrompt` API函数
- ✨ KeyframeEditor新增AI优化按钮
- ✨ 增强关键帧提示词模板，包含更丰富的视觉细节
- 🔧 优化起始帧和结束帧的差异化描述逻辑
